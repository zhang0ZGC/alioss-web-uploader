!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).AliOSSWebUploader=e()}(this,(function(){"use strict";var t=function(){return(t=Object.assign||function(t){for(var e,n=1,r=arguments.length;r>n;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function e(t){return t.replace(/^\/+/,"")}function n(t){var e,n,r,o="",i=-1;if(t&&t.length)for(r=t.length;(i+=1)<r;)e=t.charCodeAt(i),n=r>i+1?t.charCodeAt(i+1):0,55296>e||e>56319||56320>n||n>57343||(e=65536+((1023&e)<<10)+(1023&n),i+=1),e>127?e>2047?e>65535?e>2097151||(o+=String.fromCharCode(240|e>>>18&7,128|e>>>12&63,128|e>>>6&63,128|63&e)):o+=String.fromCharCode(224|e>>>12&15,128|e>>>6&63,128|63&e):o+=String.fromCharCode(192|e>>>6&31,128|63&e):o+=String.fromCharCode(e);return o}function r(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}function o(t,e){return t<<e|t>>>32-e}function i(t,e){for(var n,r=e?"0123456789ABCDEF":"0123456789abcdef",o="",i=0,s=t.length;s>i;i+=1)n=t.charCodeAt(i),o+=r.charAt(n>>>4&15)+r.charAt(15&n);return o}function s(t){var e,n=32*t.length,r="";for(e=0;n>e;e+=8)r+=String.fromCharCode(t[e>>5]>>>24-e%32&255);return r}function a(t){var e,n=8*t.length,r=Array(t.length>>2),o=r.length;for(e=0;o>e;e+=1)r[e]=0;for(e=0;n>e;e+=8)r[e>>5]|=(255&t.charCodeAt(e/8))<<24-e%32;return r}function u(t,e){var n,r,o,i,s,a,u,c,h=e.length,f=[];for(i=(a=Array(Math.ceil(t.length/2))).length,n=0;i>n;n+=1)a[n]=t.charCodeAt(2*n)<<8|t.charCodeAt(2*n+1);for(;a.length>0;){for(s=[],o=0,n=0;a.length>n;n+=1)o=(o<<16)+a[n],o-=(r=Math.floor(o/h))*h,(s.length>0||r>0)&&(s[s.length]=r);f[f.length]=o,a=s}for(u="",n=f.length-1;n>=0;n--)u+=e.charAt(f[n]);for(c=Math.ceil(8*t.length/(Math.log(e.length)/Math.log(2))),n=u.length;c>n;n+=1)u=e[0]+u;return u}function c(t,e){void 0===e&&(e="=");var n,r,o,i="",s=t.length;for(n=0;s>n;n+=3)for(o=t.charCodeAt(n)<<16|(s>n+1?t.charCodeAt(n+1)<<8:0)|(s>n+2?t.charCodeAt(n+2):0),r=0;4>r;r+=1)i+=8*n+6*r>8*t.length?e:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(o>>>6*(3-r)&63);return i}function h(t){var e=t.responseText||t.response;if(!e)return e;try{return JSON.parse(e)}catch(t){return e}}function f(t,e){var n=new XMLHttpRequest;n.timeout=e.timeout||6e4,e.onProgress&&n.upload&&(n.upload.onprogress=function(t){t.total>0&&(t.percent=t.loaded/t.total*100),e.onProgress(t)}),n.onerror=function(t){e.onError(t)},n.onload=function(){if(200>n.status||n.status>=300)return e.onError(function(t,e,n){var r=n.response.match(/<Code>(.+)<\/Code>/),o=e.method||"GET",i=Error("["+n.status+"] "+o+" "+t+"': "+(r&&r[1]||""));return i.status=n.status,i.method=o,i.code=r&&r[1]||"",i.url=t,i}(t,e,n),h(n));var r={status:n.status,statusText:n.statusText,xhr:n,data:h(n)};e.onSuccess(r,n)},n.ontimeout=function(t){e.onError(Error("Request timeout, limit "+n.timeout+" ms."))},n.open(e.method||"get",t,!0),e.withCredentials&&"withCredentials"in n&&(n.withCredentials=!0);var r=e.headers||{};for(var o in null!==r["X-Requested-With"]&&n.setRequestHeader("X-Requested-With","XMLHttpRequest"),r)r.hasOwnProperty(o)&&null!==r[o]&&n.setRequestHeader(o,r[o]);return n.send(e.data||null),{abort:function(){n.abort()}}}var p=function(t){var e=!(!t||"boolean"!=typeof t.uppercase)&&t.uppercase,h=t&&"string"==typeof t.pad?t.pad:"=",f=!t||"boolean"!=typeof t.utf8||t.utf8;function p(t,e){var n,i,s,a,u,c,h,f,p=Array(80),l=1732584193,d=-271733879,v=-1732584194,m=271733878,C=-1009589776;for(t[e>>5]|=128<<24-e%32,t[15+(e+64>>9<<4)]=e,n=0;t.length>n;n+=16){for(a=l,u=d,c=v,h=m,f=C,i=0;80>i;i+=1)p[i]=16>i?t[n+i]:o(p[i-3]^p[i-8]^p[i-14]^p[i-16],1),s=r(r(o(l,5),g(i,d,v,m)),r(r(C,p[i]),y(i))),C=m,m=v,v=o(d,30),d=l,l=s;l=r(l,a),d=r(d,u),v=r(v,c),m=r(m,h),C=r(C,f)}return[l,d,v,m,C]}function l(t,e){return s(p(a(t=e?n(t):t),8*t.length))}function d(t,e){var r,o,i,u,c;for(t=f?n(t):t,e=f?n(e):e,(r=a(t)).length>16&&(r=p(r,8*t.length)),o=Array(16),i=Array(16),u=0;16>u;u+=1)o[u]=909522486^r[u],i[u]=1549556828^r[u];return c=p(o.concat(a(e)),512+8*e.length),s(p(i.concat(c),672))}function g(t,e,n,r){return 20>t?e&n|~e&r:40>t?e^n^r:60>t?e&n|e&r|n&r:e^n^r}function y(t){return 20>t?1518500249:40>t?1859775393:60>t?-1894007588:-899497514}this.hex=function(t){return i(l(t,f),e)},this.b64=function(t){return c(l(t,f),h)},this.any=function(t,e){return u(l(t,f),e)},this.raw=function(t){return l(t,f)},this.hex_hmac=function(t,e){return i(d(t,e))},this.b64_hmac=function(t,e){return c(d(t,e),h)},this.any_hmac=function(t,e,n){return u(d(t,e),n)},this.setUpperCase=function(t){return"boolean"==typeof t&&(e=t),this},this.setPad=function(t){return h=t||h,this},this.setUTF8=function(t){return"boolean"==typeof t&&(f=t),this}};return function(){function r(e){if(!(this instanceof r))return new r(e);if(!e.bucket)throw Error("bucket is required.");var n=t(t({endpoint:null,region:"oss-cn-hangzhou",timeout:3e5,internal:!1,secure:void 0},e),{host:""});if(n.endpoint);else{if(!n.region)throw Error("require options.endpoint or options.region");n.endpoint=n.bucket,n.internal&&(n.endpoint+="-internal"),n.endpoint+="."+n.region+".aliyuncs.com"}n.host+="http"+(!0===n.secure||location&&"https:"===location.protocol?"s":"")+"://"+n.endpoint,this.opts=n}return r.prototype.postObject=function(r,o,i){var s;i.policy||(i.policy={});var a,u,h=new FormData;if(h.append("key",e(r)),this.opts.accessKeyId&&this.opts.accessKeySecret){if("string"==typeof i.policy)s=i.policy;else{var l=t({expiration:new Date(+new Date+604800).toISOString(),conditions:[{bucket:this.opts.bucket},{key:e(r)},["content-length-range",0,1073741824]]},i.policy);s=c(n(JSON.stringify(l)))}var d=i.signature||(a=this.opts.accessKeySecret,u=s,(new p).b64_hmac(a,u));h.append("OSSAccessKeyId",this.opts.accessKeyId),h.append("policy",s),h.append("Signature",d),this.opts.stsToken&&h.append("x-oss-security-token",this.opts.stsToken)}var g=function(t,e){void 0===e&&(e=[]);var n={};return Object.keys(t).forEach((function(r){var o=r.toLowerCase();("x-oss-"===o.substr(0,6)||e.indexOf(r)>-1)&&(n[o]=t[r])})),n}(i,["success_action_status","success_action_redirect"]);Object.keys(g).forEach((function(t){return h.append(t,g[t])})),h.append("file",o);var y={method:"POST",data:h,timeout:i.timeout||this.opts.timeout,onSuccess:i.onSuccess||function(){},onError:i.onError||function(t){console.error(t)}};return i.onProgress&&(y.onProgress=i.onProgress),f(this.opts.host,y)},r.prototype.generateObjectUrl=function(t,n){return n?"/"!==n[n.length-1]&&(n+="/"):n=this.opts.host+"/",n+function(t){return encodeURIComponent(t).replace(/%2F/g,"/")}(e(t))},r}()}));
//# sourceMappingURL=alioss-web-uploader.min.js.map
